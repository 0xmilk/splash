start on runlevel [2345]
stop on runlevel [06]

limit nofile 32768 32768
env DISPLAY=:0
respawn

script
    [ -r /etc/default/splash ] && . /etc/default/splash
    totmem=$(awk '/MemTotal/{print $2}' /proc/meminfo)
    maxrss=$(($totmem*3/4))

    logdir=${SPLASH_LOGDIR:-/var/log/splash}
    profiles=${SPLASH_PROFILES:-/etc/splash/proxy-profiles}
    cache=${SPLASH_CACHEDIR:-/var/cache/splash}
    chown proxy:proxy $logdir $profiles $cache

    exec start-stop-daemon --start \
        --chuid proxy:proxy \
        --pidfile /var/run/splash.pid \
        --exec /usr/bin/python -- \
            -m splash.server \
            -m $maxrss \
            -f $logdir/splash.log \
            --proxy-profiles-path=$profiles \
            --cache --cache-path=$cache \
            >$logdir/splash.out 2>$logdir/splash.err
end script
